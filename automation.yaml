#################################################################
## Automations
#################################################################

        ##########################################################
        ## _USER1_ Home from Walking Unlock Doors
        ##########################################################

- alias: _USER1_ Home from Waling Unlock Doors

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean._USER1_away_driving
      state: 'off'

  action:
    - service: lock.unlock
      entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## _USER1_ Home from Driving Open Garage Door Unlock Door
        ##########################################################

- alias: _USER1_ Home from Driving Open Garage Door Unlock Door

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER1_away
      state: 'on'
    - condition: state
      entity_id: input_boolean._USER1_away_driving
      state: 'on'

  action:
    - service: cover.open_cover
      entity_id: cover.garage_door
    - service: lock.unlock
      entity_id: lock.back_door

        ##########################################################
        ## After _USER1_ Home Lock Doors
        ########################################################

- alias: _USER1_ Home Lock Doors

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'

  action:
    - service: lock.lock
      entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## After _USER1_ Home Close Garage Door
        ########################################################

- alias: _USER1_ Home Close Garage

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## _USER2_ Home from Waling Unlock Doors
        ##########################################################

- alias: _USER2_ Home from Waling Unlock Doors

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean._USER2_away_driving
      state: 'off'


  action:
    - service: lock.unlock
      entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## _USER2_ Home from Driving Open Garage Door Unlock Door
        ##########################################################

- alias: _USER2_ Home from Driving Open Garage Door Unlock Door

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean._USER2_away_driving
      state: 'on'

  action:
    - service: cover.open_cover
      entity_id: cover.garage_door
    - service: lock.unlock
      entity_id: lock.back_door

        ##########################################################
        ## After _USER2_ Home Lock Doors
        ########################################################

- alias: _USER2_ Home Lock Doors

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'

  action:
    - service: lock.lock
      entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## After _USER2_ Home Close Garage Door
        ########################################################

- alias: _USER2_ Home Close Garage

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## _USER1_ Home Turn on Lights
        ##########################################################

- alias: _USER1_ Home Turn on Lights

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER1_away
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: light.kitchen_cabinets, light.kitchen_sink, group.living_room_lights, light.hallway_light, light.dining_room_table
      data:
       xy_color: [ 0.5134, 0.4149 ]
       brightness: 150
    - service: light.turn_on
      entity_id: group.front_porch, group.back_door
      data:
       brightness: 255

        ##########################################################
        ## _USER1_ Home Reset Front Porch Brightness
        ##########################################################

- alias: _USER1_ Home Reset Front Porch Brightness

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 100
        transition: 60

        ##########################################################
        ## _USER2_ Home Turn on Lights
        ##########################################################

- alias: _USER2_ Home Turn on Lights

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER2_away
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: light.kitchen_cabinets, light.kitchen_sink, group.living_room_lights, light.hallway_light, light.dining_room_table
      data:
       xy_color: [ 0.5134, 0.4149 ]
       brightness: 150
    - service: light.turn_on
      entity_id: group.front_porch, group.back_door
      data:
       brightness: 255

        ##########################################################
        ## _USER2_ Home Reset Front Porch Brightness
        ##########################################################

- alias: _USER2_ Home Reset Front Porch Brightness

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 100
        transition: 60

        ##########################################################
        ## Away Mode
        ##########################################################

- alias: Away Mode

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: lock.lock
      entity_id: group.all_locks
    - service: light.turn_off
      entity_id: group.interior_lights
    - service: switch.turn_off
      entity_id: switch.air_purifier, switch.basement_heater, switch.lower_backyard_outdoor_lighting, switch.lower_patio_outdoor_lighting, switch.fireplace
    - service: cover.close_cover
      entity_id: cover.garage_door
    - service: homeassistant.turn_off
      entity_id: input_boolean.interior_holiday, input_boolean.office_rainbow, input_boolean.livingroom_rainbow, input_boolean.front_porch_rainbow
    - service: input_select.select_option
      data:
        entity_id: input_select.remote
        option: "PowerOff"
    - service: media_player.media_stop
      entity_id:
        - media_player.media_center
        - media_player.living_room_sp
        - media_player.dining_room
        - media_player.kitchen
        - media_player.bathroom
        - media_player._USER1_s_office
        - media_player._USER2_s_office
        - media_player.basement

        ##########################################################
        ## Close Garage Door when _USER1_ Leaves
        ##########################################################

- alias: Close Garage when _USER1_ Leaves

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_away
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Close Garage Door when _USER2_ Leaves
        ##########################################################

- alias: Close Garage when _USER2_ Leaves

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_away
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Plex Lights On/Off
        ##########################################################

- alias: "Media player paused/stopped"

  trigger:
    - platform: state
      entity_id: media_player.living_room
      from: 'playing'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.plex_lights_disable
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lights
      data:
       transition: 3
       profile: relax
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
       brightness: 25
    - service: light.turn_on
      entity_id: light.dining_room_table, light.bathroom_vanity, light.kitchen_cabinets, light.kitchen_sink
      data:
       brightness: 100

- alias: "Media player playing"

  trigger:
       - platform: state
         entity_id: media_player.living_room
         to: 'playing'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.plex_lights_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.living_room_lights, light.hallway_light
      data:
       transition: 5
    - service: light.turn_off
      entity_id: group.dining_room, group.kitchen, light.bathroom_vanity

        ##########################################################
        ## Set Thermostat Away/Home
        ##########################################################

- alias: Thermostat - Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away
#     re-enable Summer or Winter Mode
#    - service: homeassistant.turn_on
#      entity_id: group.summer_mode
    - service: homeassistant.turn_on
      entity_id: group.winter_mode

- alias: Thermostat - Away

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away
    - service: homeassistant.turn_off
      entity_id: group.summer_mode
    - service: homeassistant.turn_off
      entity_id: group.winter_mode

        ##########################################################
        ## Set Thermostat Home When _USER2_ Leaves Work
        ##########################################################

- alias: Set Thermostat Home When _USER2_ Leaves Work

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'work'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'not_home'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away


        ##########################################################
        ## Turn Thermostat on Summer
        ##########################################################

- alias: Turn Thermostat on Summer

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_temperature
      above: 70

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away

        ##########################################################
        ## Turn Thermostat off Summer
        ##########################################################

- alias: Turn Thermostat off Summer

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_temperature
      below: 69

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away

        ##########################################################
        ## Turn Thermostat on Winter
        ##########################################################

- alias: Turn Thermostat on Winter

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_temperature
      below: 65

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.thermostat_away

        ##########################################################
        ## Turn Thermostat off Winter
        ##########################################################

- alias: Turn Thermostat off Winter

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_temperature
      above: 66

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away

        ##########################################################
        ## Disable Summer / Winter Mode on Start
        ##########################################################

- alias: Disable Summer or Winter Mode on Start

  trigger:
    - platform: event
      event_type: homeassistant_start

  action:
#     Disable Summer or Winter Mode
    - service: homeassistant.turn_off
      entity_id: group.summer_mode
#    - service: homeassistant.turn_on
#      entity_id: group.winter_mode

        ##########################################################
        ## Turn off Thermostat when Door Opens for Extended Period
        ##########################################################

- alias: Turn off Thermostat when Door Opens for Extended Period

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: group.summer_mode
      state: 'on'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.thermostat_away


        ##########################################################
        ## Turn On Front Porch when Door Bell Rings
        ##########################################################

- alias: Turn On Front Porch when Door Bell Rings

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 255

        ##########################################################
        ## Reset Front Porch Brightness After Doorbell Rings
        ##########################################################

- alias: Reset Front Porch Brightness After Doorbell Rings

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 100
        transition: 300

        ##########################################################
        ## Turn On Front Porch when Motion Detected
        ##########################################################

- alias: Turn On Front Porch when Motion Detected

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_motion
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 255

        ##########################################################
        ## Reset Front Porch Brightness After Motion Detected
        ##########################################################

- alias: Reset Front Porch Brightness After Motion Detected

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_motion
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 100
        transition: 300

        ##########################################################
        ## Turn On Lights when Door Bell Rings and Away
        ##########################################################

- alias: Turn On Lights when Door Bell Rings and Away

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lights, light.office_lamp, light.closet_lamp, light.kitchen_ceiling
      data:
        brightness: 255

        ##########################################################
        ## Turn Off Lights After Door Bell Rings and Away
        ##########################################################

- alias: Turn Off Lights After Door Bell Rings and Away

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: light.turn_off
      entity_id: group.living_room_lights, light.office_lamp, light.closet_lamp
      data:
        transition: 900
    - service: light.turn_off
      entity_id: light.kitchen_ceiling

        ##########################################################
        ## Turn On Lights when Motion Detected and Away
        ##########################################################

- alias: Turn On Lights when Motion Detected and Away

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_motion
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lights, light.office_lamp, light.closet_lamp, light.kitchen_ceiling
      data:
        brightness: 255

        ##########################################################
        ## Turn Off Lights After Motion Detected and Away
        ##########################################################

- alias: Turn Off Lights After Motion Detected and Away

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_motion
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: light.turn_off
      entity_id: group.living_room_lights, light.office_lamp, light.closet_lamp
      data:
        transition: 900
    - service: light.turn_off
      entity_id: light.kitchen_ceiling

        ##########################################################
        ## Turn On Front Porch when Door Opens
        ##########################################################

- alias: Turn on Front Porch when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 255

        ##########################################################
        ## Reset Front Door Brightness when Door Closes
        ##########################################################

- alias: Reset Front Porch Brightness when Door Closes

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        brightness: 100
        transition: 120

        ##########################################################
        ## Turn off Front Porch when Door Closes between 12-5a
        ##########################################################

- alias: Turn off Front Porch when Door Closes between 12-5a

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  condition:
    - condition: time
      after: '00:00'
      before: '05:00'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  action:
    - service: light.turn_off
      entity_id: group.front_porch
      data:
        transition: 900

        ##########################################################
        ## Turn On Living Room when Door Opens
        ##########################################################

- alias: Turn on Front Porch when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_opened
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lights
      data:
       xy_color: [ 0.5134, 0.4149 ]
       brightness: 255

        ##########################################################
        ## Turn On Back Door when Door Opens
        ##########################################################

- alias: Turn on Back Door when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.back_door
      data:
       brightness: 255

        ##########################################################
        ## Reset Back Door Brightness when Door Closes
        ##########################################################

- alias: Reset Back Door Brightness when Door Closes

  trigger:
    - platform: state
      entity_id: binary_sensor.back_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.back_door
      data:
        brightness: 3
        transition: 300

        ##########################################################
        ## Turn off Back Door when Door Closes between 12-5a
        ##########################################################

- alias: Turn off Back Door when Door Closes between 12-5a

  trigger:
    - platform: state
      entity_id: binary_sensor.back_door_opened
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 17
        seconds: 0

  condition:
    - condition: time
      after: '00:00'
      before: '05:00'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: light.turn_off
      entity_id: group.back_door
      data:
        transition: 900

        ##########################################################
        ## Turn off Garage Light when Garage Closed
        ########################################################

- alias: Turn off Garage Light when Garage Closed

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: light.garage_light

        ##########################################################
        ## Turn on Garage Light when Garage Open
        ########################################################

- alias: Turn on Garage Light when Garage Open

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  condition:
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'

  action:
    - service: light.turn_on
      entity_id: light.garage_light
      data:
       brightness: 255

        ##########################################################
        ## Turn off Garage Light after an Hour
        ########################################################

- alias: Turn off Garage Light after an Hour

  trigger:
    - platform: state
      entity_id: light.garage_light
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 60
        seconds: 0

  action:
    - service: light.turn_off
      entity_id: light.garage_light

        ##########################################################
        ## Close Garage Door after 30 Mins
        ##########################################################

- alias: 'Close Garage Door After 30 Mins'

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Lock Front Door After 30 Mins
        ##########################################################

- alias: 'Lock Front Door After 30 Mins'

  trigger:
    - platform: state
      entity_id: lock.front_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door_opened
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'

  action:
    - service: lock.lock
      entity_id: lock.front_door

        ##########################################################
        ## Lock Back Door After 2 Hours
        ##########################################################

- alias: 'Lock Front Door After 2 Hours'

  trigger:
    - platform: state
      entity_id: lock.back_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  action:
    - service: lock.lock
      entity_id: lock.back_door

        ##########################################################
        ## Lock Basement Door After 45 Mins
        ##########################################################

- alias: 'Lock Basement Door After 45 Mins'

  trigger:
    - platform: state
      entity_id: lock.basement_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 45
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.basement_door_opened
      state: 'off'
    - condition: state
      entity_id: lock.basement_door
      state: 'unlocked'

  action:
    - service: lock.lock
      entity_id: lock.basement_door

        ##########################################################
        ## Lock Back Door when _USER2_ Leaves in the Morning
        ##########################################################

- alias: Lock Back Door when _USER2_ Leaves

  trigger:
     - platform: state
       entity_id: device_tracker._USER2_
       from: 'home'
       to: 'not_home'

  condition:
    - condition: time
      after: '05:00'
      before: '07:00'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door_opened
      state: 'off'
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  action:
    - service: lock.lock
      entity_id: lock.back_door

        ##########################################################
        ## Lock Doors at 2a
        ##########################################################

- alias: 'Lock Doors at 2a'

  trigger:
    - platform: time
      after: '02:00'

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: group.doors
      state: 'off'

  action:
    - service: lock.lock
      entity_id: group.all_locks

        ##########################################################
        ## Turn On Front Porch at Sunset
        ##########################################################

- alias: Turn on Front Porch at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        transition: 300
        brightness: 100
        profile: relax

        ##########################################################
        ## Turn Off Front Porch at Midnight
        ##########################################################

- alias: Turn Off Front Porch at Midnight

  trigger:
   - platform: time
     after: '23:59'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'None'

  action:
    - service: light.turn_off
      entity_id: group.front_porch
      data:
       transition: 300

        ##########################################################
        ## Turn On Back Door at Sunset
        ##########################################################

- alias: Turn On Back Door at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.back_door
      data:
        brightness: 3
        transition: 60

        ##########################################################
        ## Turn Off Back Door at Midnight
        ##########################################################

- alias: Back Door Off at Midnight

  trigger:
    - platform: time
      after: '23:59'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'

  action:
   - service: light.turn_off
     entity_id: group.back_door
     data:
       transition: 300

        ##########################################################
        ## Turn on Back Door at 5:00a if _USER2_ Home
        ##########################################################

- alias: Back Door on at 5a

  trigger:
    - platform: time
      after: '05:00'

  condition:
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.lights_morning_disable
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.back_door
      data:
       brightness: 3
       transition: 60

        ##########################################################
        ## Turn on Lights at 5a if _USER2_ Home
        ##########################################################

- alias: Turn on Interior Lights at 5a

  trigger:
    - platform: time
      after: '05:00'

  condition:
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.lights_morning_disable
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: light.dining_room_table, light.kitchen_cabinets, light.kitchen_sink, group.living_room_lights, light.bahtroom_vanity
      data:
       brightness: 25
       xy_color: [ 0.5134, 0.4149 ]
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
       brightness: 50
       color_name: red

        ##########################################################
        ## Open Garage Door when _USER2_ Leaves
        ##########################################################

- alias: _USER2_ Leaving Open Garage

  trigger:
    - platform: state
      entity_id: binary_sensor.back_door_opened
      from: 'off'
      to: 'on'

  condition:
    - condition: time
      after: '05:00'
      before: '07:00'
    - condition: state
      entity_id: input_boolean.disable_auto_garage
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER2_away
      state: 'off'

  action:
    - service: cover.open_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Turn off Lights when _USER2_ Leaves
        ##########################################################

- alias: Turn off Lights when _USER2_ Leaves

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'home'
      to: 'not_home'

  condition:
    - condition: time
      after: '05:00'
      before: '07:00'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.interior_lights, group.back_door

        ##########################################################
        ## Turn off Lights at Sunrise
        ##########################################################

- alias: Turn off Lights at Sunrise

  trigger:
    - platform: sun
      event: 'sunrise'
      offset: '+00:20:00'

  action:
    - service: light.turn_off
      entity_id: group.interior_lights, group.exterior_lights
    - service: switch.turn_off
      entity_id: switch.lower_backyard_outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.lower_patio_outdoor_lighting

        ##########################################################
        ## Turn on Office Air Purifier when Occupied
        ##########################################################

- alias: Turn on Office Air Purifier when Occupied

  trigger:
    - platform: state
      entity_id: binary_sensor.office_occupancy
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_air_purifier_on_off_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'

  action:
    - service: switch.turn_on
      entity_id: switch.air_purifier

        ##########################################################
        ## Turn off Office Air Purifier when Unoccupied
        ##########################################################

- alias: Turn off Office Air Purifier when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.office_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_air_purifier_on_off_disable
      state: 'off'

  action:
    - service: switch.turn_off
      entity_id: switch.air_purifier

        ##########################################################
        ## Turn off Office when Unoccupied
        ##########################################################

- alias: Turn off Office Light when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.office_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'


  action:
    - service: light.turn_off
      entity_id: group._USER1_office

        ##########################################################
        ## Turn on _USER2_ Office when Occupied
        ##########################################################

- alias: Turn on _USER2_ Office Light when Occupied

  trigger:
    - platform: state
      entity_id: binary_sensor._USER2_office_occupancy
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group._USER2_office
      data:
        transition: 300
        brightness: 130

        ##########################################################
        ## Turn off _USER2_ Office when Unoccupied
        ##########################################################

- alias: Turn off _USER2_ Office Light when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor._USER2_office_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group._USER2_office

        ##########################################################
        ## Turn off Bedroom when Unoccupied
        ##########################################################

- alias: Turn off Bedroom Lights when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.bedroom_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.bedroom

        ##########################################################
        ## Turn off Guest Bedroom when Unoccupied
        ##########################################################

- alias: Turn off Guest Bedroom Lights when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.guest_bedroom_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.guest_bedroom

        ##########################################################
        ## Turn off Kitchen when Unoccupied
        ##########################################################

- alias: Turn off Kitchen Lights when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.kitchen_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.kitchen

        ##########################################################
        ## Turn off Dining Room / Hallway when Unoccupied
        ##########################################################

- alias: Turn off Dining Room Lights when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.main_floor_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: light.hallway_light, group.dining_room

        ##########################################################
        ## Turn off Living Room when Unoccupied
        ##########################################################

- alias: Turn off Living Room when Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.living_room_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: binary_sensor.main_floor_occupancy
      state: 'off'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.living_room

        ##########################################################
        ## Turn off Stairs when Unoccupied
        ##########################################################

- alias: Turn off Stairs when _USER1_ Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor.office_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: binary_sensor._USER2_office_occupancy
      state: 'off'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.stairs

- alias: Turn off Stairs when _USER2_ Office Unoccupied

  trigger:
    - platform: state
      entity_id: binary_sensor._USER2_office_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'off'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.stairs


        ##########################################################
        ## Turn off Basement when Unoccupied
        ##########################################################

- alias: Turn off Basement when Unoccupied

  trigger:
    - platform: state
      entity_id: group.basement_occupancy
      from: 'on'
      to: 'off'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.basement_lighting

        ##########################################################
        ## Turn on Living Room / Dining Room at Sunset when Occupied
        ##########################################################

- alias: Turn on Living Room / Dining Room at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:30:00'

  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.main_floor_occupancy
            state: 'on'
          - condition: state
            entity_id: binary_sensor.living_room_occupancy
            state: 'on'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lamps, light.dining_room_table, light.hallway_light, light.media_center_lighting
      data:
        transition: 900
        xy_color: [ 0.5134, 0.4149 ]
        brightness: 255

        ##########################################################
        ## Turn on Kitchen at Sunset when Occupied
        ##########################################################

- alias: Turn on Kitchen at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:30:00'

  condition:
    - condition: state
      entity_id: binary_sensor.kitchen_occupancy
      state: 'on'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group.kitchen
      data:
        brightness: 255

        ##########################################################
        ## Turn on Office at Sunset when Occupied
        ##########################################################

- alias: Turn on Office Lights at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:10:00'

  condition:
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.office_lights_sunset
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: light.office_lamp, group.stairs
      data:
        transition: 900
        brightness: 75
        profile: relax

        ##########################################################
        ## Turn on _USER2_'s Office at Sunset when Occupied
        ##########################################################

- alias: Turn on _USER2_ Office Lights at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:30:00'

  condition:
    - condition: state
      entity_id: binary_sensor._USER2_office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.office_lights_sunset
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group._USER2_office, group.stairs
      data:
        transition: 900
        brightness: 255

        ##########################################################
        ## Turn On/Off First Floor Lights During Rain
        ##########################################################

- alias: Rainy Day First Floor

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      above: 1

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: time
      after: '09:00'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: binary_sensor.main_floor_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lamps, light.kitchen_cabinets, light.dining_room_table, light.media_center_lighting, light.hallway_light
      data:
        xy_color: [ 0.5134, 0.4149 ]
        brightness: 50

- alias: Rain is over First Floor

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      below: 1

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'

  action:
    - service: light.turn_off
      entity_id: group.living_room_lamps, light.kitchen_cabinets, light.dining_room_table, light.media_center_lighting, light.hallway_light

        ##########################################################
        ## Turn On/Off _USER2_ Office During Rain
        ##########################################################

- alias: Rainy Day _USER2_ Office

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      above: 1

  condition:
    - condition: state
      entity_id: binary_sensor._USER2_office_occupancy
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group._USER2_office, group.stairs
      data:
        brightness: 50

- alias: Rain is over _USER2_ Office

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      below: 1

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'

  action:
    - service: light.turn_off
      entity_id: group._USER2_office, group.stairs

        ##########################################################
        ## Turn On/Off _USER1_ Office During Rain
        ##########################################################

- alias: Rainy Day _USER1_ Office

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      above: 1

  condition:
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: light.office_lamp, group.stairs
      data:
        brightness: 30
        xy_color: [0.139,0.081]

- alias: Rain is over _USER1_ Office

  trigger:
    - platform: numeric_state
      entity_id: sensor.dark_sky_precip_intensity
      below: 1

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'

  action:
    - service: light.turn_off
      entity_id: light.office_lamp, group.stairs

        ##########################################################
        ## Turn On Outdoor Lighting at Sunset
        ##########################################################

- alias: Turn on Outdoor Lighting at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: switch.turn_on
      entity_id: switch.lower_patio_outdoor_lighting
    - service: switch.turn_on
      entity_id: switch.lower_backyard_outdoor_lighting

        ##########################################################
        ## Turn Off Outdoor Lighting After 4 Hours
        ##########################################################

- alias: Turn off Outdoor Lighting After 4 Hours

  trigger:
    - platform: state
      entity_id: group.outdoor_lighting
      from: 'off'
      to: 'on'
      for:
        hours: 4
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'
    - condition: time
      after: '22:00'

  action:
    - service: switch.turn_off
      entity_id: switch.lower_backyard_outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.lower_patio_outdoor_lighting

        ##########################################################
        ## Turn Off Outdoor Lighting At Midnight on Weekends
        ##########################################################

- alias: Turn off Outdoor Lighting at Midnight on Weekends

  trigger:
    - platform: time
      after: '23:59'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'
    - condition: time
      weekday:
        - fri
        - sat

  action:
    - service: switch.turn_off
      entity_id: switch.lower_backyard_outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.lower_patio_outdoor_lighting

        ##########################################################
        ## Turn Off Outdoor Lighting At 10:00p on Weekdays
        ##########################################################

- alias: Turn off Outdoor Lighting at 10p on Weekdays

  trigger:
    - platform: time
      after: '22:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'
    - condition: time
      weekday:
        - sun
        - mon
        - tue
        - wed
        - thu

  action:
    - service: switch.turn_off
      entity_id: switch.lower_backyard_outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.lower_patio_outdoor_lighting

        ##########################################################
        ## Turn Off Outdoor Lighting At 2a on Weekdays
        ##########################################################

- alias: Turn off Outdoor Lighting at 2a on Weekdays

  trigger:
    - platform: time
      after: '02:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'
    - condition: time
      weekday:
        - mon
        - tue
        - wed
        - thu

  action:
    - service: switch.turn_off
      entity_id: switch.lower_backyard_outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.lower_patio_outdoor_lighting


        ##########################################################
        ## Turn on Outdoor Lighting when Home
        ##########################################################

- alias: Turn on Outdoor Lighting when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_boolean.home_away
        state: 'off'
      - condition: state
        entity_id: sun.sun
        state: 'below_horizon'
      - condition: or
        conditions:
          - condition: state
            entity_id: input_boolean._USER1_away
            state: 'on'
          - condition: state
            entity_id: input_boolean._USER2_away
            state: 'on'

  action:
    - service: switch.turn_on
      entity_id: switch.lower_patio_outdoor_lighting
    - service: switch.turn_on
      entity_id: switch.lower_backyard_outdoor_lighting

##################################################################
## Holiday Lighting
##################################################################

        ##########################################################
        ## Christmas Lighting
        ##########################################################

- alias: Christmas Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: red

- alias: Christmas Lighting Rotate on the Hour

  trigger:
    platform: time
    minutes: 0
    seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00'
      before: '23:59'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 5
        brightness: 255
        color_name: green

- alias: Christmas Lighting Rotate 15 mins after the Hour

  trigger:
    platform: time
    minutes: 15
    seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00'
      before: '23:59'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 5
        brightness: 255
        color_name: red

- alias: Christmas Lighting Rotate 30 Mins after the Hour

  trigger:
    platform: time
    minutes: 30
    seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00'
      before: '23:59'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 5
        brightness: 255
        color_name: green

- alias: Christmas Lighting Rotate 45 Mins After the Hour

  trigger:
    platform: time
    minutes: 45
    seconds: 0

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: time
      after: '15:00'
      before: '23:59'
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 5
        brightness: 255
        color_name: red

        ##########################################################
        ## Halloween Lighting
        ##########################################################

- alias: Halloween Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]

        ##########################################################
        ## St. Patricks Day Lighting
        ##########################################################

- alias: St. Patricks Day Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "St. Patrick's Day"

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: green

        ##########################################################
        ## Valentine's Day Lighting
        ##########################################################

- alias: Valentine's Day Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "Valentine's Day"

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: "hot pink"
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: "hot pink"

        ##########################################################
        ## Cardinals Game Lighting
        ##########################################################

- alias: Cardinals Game Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Cardinals Game'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: red

        ##########################################################
        ## Blues Game Lighting
        ##########################################################

- alias: Blues Game Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Blues Game'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: blue

        ##########################################################
        ## Easter Lighting
        ##########################################################

- alias: Easter Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Easter'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: indigo
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        xy_color: [ 0.4283, 0.2298 ]

        ##########################################################
        ## Thanksgiving Lighting
        ##########################################################

- alias: Thanksgiving Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Thanksgiving'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        # Orange
        xy_color: [ 0.5781, 0.3921 ]
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        xy_color: [ 0.4862, 0.4599 ]

        ##########################################################
        ## Independence / Memorial / Veterans / Labor Day Lighting
        ##########################################################

- alias: Independence / Memorial / Veterans / Labor Day Lighting

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.holiday
        state: 'Labor Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Memorial Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Independence Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Veterans Day'

  action:
    - service: light.turn_on
      entity_id: light.front_porch_left
      data:
        transition: 900
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.front_porch_right
      data:
        transition: 900
        brightness: 255
        color_name: red

        ##########################################################
        ## Christmas Lighting Interior
        ##########################################################

- alias: Christmas Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 60
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: green

- alias: Christmas Lighting Rotate Hour Interior

  trigger:
    platform: time
    minutes: 0
    seconds: 0

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'
    - condition: state
      entity_id: input_boolean.interior_holiday
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: green

- alias: Christmas Lighting Rotate 30 Min Interior

  trigger:
    platform: time
    minutes: 30
    seconds: 0

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Christmas'
    - condition: state
      entity_id: input_boolean.interior_holiday
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: red

        ##########################################################
        ## Halloween Lighting Interior
        ##########################################################

- alias: Halloween Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Halloween'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        # Dark Orange
        xy_color: [ 0.6164, 0.3645 ]

        ##########################################################
        ## St. Patricks Day Lighting Interior
        ##########################################################

- alias: St. Patricks Day Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: "St. Patrick's Day"

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: green
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: green

        ##########################################################
        ## Valentine's Day Lighting Interior
        ##########################################################

- alias: Valentine's Day Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: "Valentine's Day"

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: "hot pink"
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: "hot pink"
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: "hot pink"
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: "hot pink"

        ##########################################################
        ## Cardinals Game Lighting Interior
        ##########################################################

- alias: Cardinals Game Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Cardinals Game'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: red

        ##########################################################
        ## Blues Game Lighting Interior
        ##########################################################

- alias: Blues Game Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'
    - condition: state
      entity_id: input_select.holiday
      state: 'Blues Game'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: blue

        ##########################################################
        ## Easter Lighting Interior
        ##########################################################

- alias: Easter Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Easter'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: indigo
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        xy_color: [ 0.4283, 0.2298 ]
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        xy_color: [ 0.4283, 0.2298 ]
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: indigo

        ##########################################################
        ## Thanksgiving Lighting Interior
        ##########################################################

- alias: Thanksgiving Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: input_select.holiday
      state: 'Thanksgiving'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        # Orange
        xy_color: [ 0.5781, 0.3921 ]
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        xy_color: [ 0.4862, 0.4599 ]
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        xy_color: [ 0.5781, 0.3921 ]
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        xy_color: [ 0.4862, 0.4599 ]

        ##########################################################
        ## Independence / Memorial / Veterans / Labor Day Lighting Interior
        ##########################################################

- alias: Independence / Memorial / Veterans / Labor Day Lighting Interior

  trigger:
    - platform: state
      entity_id: input_boolean.interior_holiday
      from: 'off'
      to: 'on'

  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.holiday
        state: 'Labor Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Memorial Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Independence Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Veterans Day'

  action:
    - service: light.turn_on
      entity_id: light.living_room_lamp_1
      data:
        transition: 5
        brightness: 255
        color_name: blue
    - service: light.turn_on
      entity_id: light.living_room_lamp_2
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
        transition: 5
        brightness: 255
        color_name: red
    - service: light.turn_on
      entity_id: light.media_center_lighting
      data:
        transition: 5
        brightness: 255
        color_name: blue

        ##########################################################
        ## Turn Off Holiday Lighting at 1:00 am
        ##########################################################

- alias: Turn Off Holiday Lighting at at 1a

  trigger:
    - platform: time
      after: '01:00'

  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.holiday
        state: 'Christmas'
      - condition: state
        entity_id: input_select.holiday
        state: 'Halloween'
      - condition: state
        entity_id: input_select.holiday
        state: "St. Patrick's Day"
      - condition: state
        entity_id: input_select.holiday
        state: 'Easter'
      - condition: state
        entity_id: input_select.holiday
        state: "Valentine's Day"
      - condition: state
        entity_id: input_select.holiday
        state: 'Thanksgiving'
      - condition: state
        entity_id: input_select.holiday
        state: 'Labor Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Memorial Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Independence Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Cardinals Game'
      - condition: state
        entity_id: input_select.holiday
        state: 'Blues Game'
      - condition: state
        entity_id: input_select.holiday
        state: 'Veterans Day'

  action:
    - service: light.turn_off
      entity_id: group.front_porch
      data:
        transition: 300

        ##########################################################
        ## Reset Holiday Lighting at 4a
        ##########################################################

- alias: Reset Holiday Lighting at 4a

  trigger:
    - platform: time
      after: '04:00'

  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.holiday
        state: 'Halloween'
      - condition: state
        entity_id: input_select.holiday
        state: "St. Patrick's Day"
      - condition: state
        entity_id: input_select.holiday
        state: 'Easter'
      - condition: state
        entity_id: input_select.holiday
        state: "Valentine's Day"
      - condition: state
        entity_id: input_select.holiday
        state: 'Thanksgiving'
      - condition: state
        entity_id: input_select.holiday
        state: 'Labor Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Memorial Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Independence Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Veterans Day'
      - condition: state
        entity_id: input_select.holiday
        state: 'Cardinals Game'
      - condition: state
        entity_id: input_select.holiday
        state: 'Blues Game'

  action:
    - service: input_select.select_option
      data:
        entity_id: input_select.holiday
        option: "None"
    - service: homeassistant.turn_off
      entity_id: input_boolean.interior_holiday

##################################################################
## Security
##################################################################

#- alias: Motion Based Security
#
#  trigger:
#    - platform: state
#      entity_id: group.occupancy
#      from: 'off'
#      to: 'on'
#
#  condition:
#    - condition: state
#      entity_id: group.household
#      state: 'not_home'
#    - condition: state
#      entity_id: input_boolean.enable_security
#      state: 'on'
#
#  action:
#    service: scene.turn_on
#    entity_id: scene.security

- alias: Security Door Open

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.enable_security
      state: 'on'

  action:
    - service: scene.turn_on
      entity_id: scene.security

##################################################################
## On Demand Automation
##################################################################

        ##########################################################
        ## Hue Random Colors
        ##########################################################

- alias: 'Set Living Room to Random Color'

  trigger:
    - platform: time
      minutes: '/2'
      seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: group.living_room, light.hallway_light, light.media_center_lighting
      data:
        effect: random
        transition: 5
        brightness: 255

- alias: 'Set Office to Random Color'

  trigger:
    - platform: time
      minutes: '/2'
      seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: light.office_lamp
      data:
        effect: random
        transition: 5
        brightness: 255

- alias: 'Set Front Porch to Random Color'

  trigger:
    - platform: time
      minutes: '/2'
      seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.front_porch_rainbow
      state: 'on'

  action:
    - service: light.turn_on
      entity_id: group.front_porch
      data:
        effect: random
        transition: 5
        brightness: 255

        ##########################################################
        ## Lock / Unlock Doors on Demand
        ##########################################################

- alias: Lock Doors on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.lock_doors
      state: 'on'

  action:
    service: lock.lock
    entity_id: group.all_locks

- alias: Reset Lock Doors Switch

  trigger:
    - platform: state
      entity_id: input_boolean.lock_doors
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 60

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.lock_doors

- alias: Unlock Doors on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.unlock_doors
      state: 'on'

  action:
    service: lock.unlock
    entity_id: group.all_locks

- alias: Reset Unlock Doors Switch

  trigger:
    - platform: state
      entity_id: input_boolean.unlock_doors
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 60

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.unlock_doors

        ##########################################################
        ## Thermostat on Demand
        ##########################################################

- alias: Thermostat On Demand Home

  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_away
      from: 'on'
      to: 'off'

  action:
    - service: climate.set_hold_mode
      data:
        entity_id: climate.main_floor
        hold_mode: None

- alias: Thermostat On Demand Away

  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_away
      from: 'off'
      to: 'on'

  action:
    - service: climate.set_away_mode
      data:
        entity_id: climate.main_floor
        away_mode: true

        ##########################################################
        ## Panic Mode
        ##########################################################

- alias: Panic Mode

  trigger:
    - platform: state
      entity_id: input_boolean.panic_mode
      state: 'on'

  action:
    - service: scene.turn_on
      entity_id: scene.security

        ##########################################################
        ## Garage Door on Demand (Echo Integration)
        ##########################################################

- alias: Open Garage Door on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.garage_door
      state: 'on'

  condition:
    - condition: state
      entity_id: cover.garage_door
      state: 'closed'

  action:
    - service: cover.open_cover
      entity_id: cover.garage_door

- alias: Close Garage Door on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.garage_door
      state: 'off'

  condition:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  action:
    - service: cover.close_cover
      entity_id: cover.garage_door

        ##########################################################
        ## Reset Dummy Garage Door Boolean Switch
        ##########################################################

- alias: Reset Dummy Garage Door Switch when Closed

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'open'
      to: 'closed'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.garage_door

- alias: Turn on Garage Door when Open

  trigger:
    - platform: state
      entity_id: cover.garage_door
      from: 'closed'
      to: 'open'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.garage_door

        ##########################################################
        ## Bedtime
        ##########################################################

- alias: Bedtime

  trigger:
    - platform: state
      entity_id: input_boolean.bedtime
      state: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  action:
    - service: lock.lock
      entity_id: group.all_locks
    - service: light.turn_off
      entity_id: group.interior_lights
    - service: light.turn_off
      entity_id: group.outdoor_lighting
    - service: switch.turn_off
      entity_id: switch.air_purifier, switch.lower_backyard_outdoor_lighting, switch.lower_patio_outdoor_lighting, switch.fireplace
    - service: cover.close_cover
      entity_id: cover.garage_door
    - service: homeassistant.turn_off
      entity_id: input_boolean.interior_holiday, input_boolean.office_rainbow, input_boolean.livingroom_rainbow, input_boolean.front_porch_rainbow
    - service: input_select.select_option
      data:
        entity_id: input_select.remote
        option: "PowerOff"
    - service: media_player.media_stop
      entity_id:
        - media_player.media_center
        - media_player.living_room_sp
        - media_player.dining_room
        - media_player.kitchen
        - media_player.bathroom
        - media_player._USER1_s_office
        - media_player._USER2_s_office
        - media_player.basement
    - service: climate.set_hold_mode
      data:
        entity_id: climate.main_floor
        hold_mode: sleep

        ##########################################################
        ## Bedtime after Midnight
        ##########################################################

- alias: Bedtime after Midnight

  trigger:
    - platform: state
      entity_id: input_boolean.bedtime
      state: 'on'
      for:
        hours: 0
        minutes: 4
        seconds: 0

  condition:
    - condition: time
      after: '00:00'
      before: '06:00'

  action:
    - service: light.turn_off
      entity_id: group.exterior_lights

        ##########################################################
        ## Reset Bedtime Switch
        ##########################################################

- alias: Reset Bedtime Switch

  trigger:
    - platform: state
      entity_id: input_boolean.bedtime
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 6
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.bedtime

        ##########################################################
        ## Turn on Vacation Mode when Gone 24 Hours
        ##########################################################

- alias: Turn on Vacation Mode when Gone 24 Hours

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 24
        minutes: 0
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn off Vacation Mode when Home
        ##########################################################

- alias: Turn off Vacation Mode when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn on Vacation Mode when on Vacation
        ##########################################################

- alias: Turn on Vacation Mode when on Vacation

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'vacation'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn on Vacation Mode when at the Lake
        ##########################################################

- alias: Turn on Vacation Mode when at the Lake

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'lake'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Turn off Vacation Mode when leaving the Lake
        ##########################################################

- alias: Turn on Vacation Mode when at the Lake

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'lake'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.vacation_mode

        ##########################################################
        ## Vacation Mode
        ##########################################################

- alias: Vacation Mode

  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  action:
    - service: scene.turn_on
      entity_id: scene.vacation

- alias: Vacation Mode Lights Off 1a

  trigger:
    - platform: time
      after: '01:12'

  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  action:
    - service: light.turn_off
      entity_id: light.basement_stairs, group.living_room_lamps

- alias: Vacation Mode Lights Off 10p

  trigger:
    - platform: time
      after: '22:32'

  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  action:
    - service: light.turn_off
      entity_id: light.office_ceiling, light.closet_lamp

- alias: Vacation Mode Disable Automation

  trigger:
    - platform: state
      entity_id: input_boolean.vacation_mode
      from: 'off'
      to: 'on'

  action:
    - service: scene.turn_on
      entity_id: scene.vacation_disable_automation

- alias: Vacation Mode Enable Automation

  trigger:
    - platform: state
      entity_id: input_boolean.vacation_mode
      from: 'on'
      to: 'off'

  action:
    - service: scene.turn_on
      entity_id: scene.vacation_enable_automation

      #################################################################
      ## Remote
      #################################################################

- alias: 'Remote external update Media Center'

  trigger:
    platform: state
    entity_id: remote.media_center

  action:
    - service: input_select.select_option
      data_template:
        entity_id: input_select.remote
        option: >
          {{ states.remote.media_center.attributes.current_activity }}

- alias: 'Remote start activity from input select media center'

  trigger:
    platform: state
    entity_id: input_select.remote

  action:
    - service: script.turn_on
      entity_id: script.input_select_harmony

##########################################################
## Notifications
##########################################################

    #################################################################
    ## Text Notifications
    #################################################################

      #################################################################
      ## Alarm Notification
      #################################################################

- alias: Security Notify

  trigger:
    - platform: state
      entity_id: input_boolean.alarm_tripped
      from: 'off'
      to: 'on'

  action:
    - service: persistent_notification.create
      data:
        message: "Alarm Has Been Tripped!"
        title: "Alarm"
        notification_id: "1"


- alias: Alarm Notification iOS

  trigger:
    - platform: state
      entity_id: input_boolean.alarm_tripped
      from: 'off'
      to: 'on'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Alarm Tripped
        data:
          push:
            category: camera
          entity_id: camera.garage_camera

        #################################################################
        ## _USER1_ Home Notification
        #################################################################

- alias: _USER1_ Home Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: _USER1_ Home
        data:
          push:
            category: map
          action_data:
            latitude: _REDACTED_
            longitude: _REDACTED_

        #################################################################
        ## _USER1_ Away Notification
        #################################################################

- alias: _USER1_ Away Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'home'
      to: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: _USER1_ Away
        data:
          push:
            category: map
          action_data:
            latitude: _REDACTED_
            longitude: _REDACTED_

        #################################################################
        ## _USER2_ Home Notification
        #################################################################

- alias: _USER2_ Home Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'not_home'
      to: 'home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: _USER2_ Home
        data:
          push:
            category: map
          action_data:
            latitude: _REDACTED_
            longitude: _REDACTED_

        #################################################################
        ## _USER2_ Away Notification
        #################################################################

- alias: _USER2_ Away Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'home'
      to: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: _USER2_ Away
        data:
          push:
            category: map
          action_data:
            latitude: _REDACTED_
            longitude: _REDACTED_

        #################################################################
        ## _USER2_ Left Work Notification
        #################################################################

- alias: _USER2_ Left Work Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'work'
      to: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: _USER2_ has left Work

        #################################################################
        ## Motion Alarm Notification
        #################################################################

- alias: Motion Based Security Notification

  trigger:
    - platform: state
      entity_id: group.alarm_occupancy
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Motion Detected
        data:
          push:
            category: camera
          entity_id: camera.garage_camera

        #################################################################
        ## Door Alarm Notification
        #################################################################

- alias: Security Door Open Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Door Opened
        data:
          push:
            category: camera
          entity_id: camera.garage_camera

        #################################################################
        ## Fireplace Alarm Notification
        #################################################################

- alias: Fireplace when Nobody Home Notification

  trigger:
    - platform: state
      entity_id: switch.fireplace
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Fireplae Turned On!

        #################################################################
        ## Home Assistant Started Notification
        #################################################################

- alias: Home Assistant Start Notification

  trigger:
    - platform: event
      event_type: homeassistant_start

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Home Assistant Started

    #################################################################
    ## Audio Notifications
    #################################################################

        ##########################################################
        ## Alarm Audio Notification
        ##########################################################

- alias: Security Notify Audio

  trigger:
    - platform: state
      entity_id: input_boolean.alarm_tripped
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'

  action:
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.media_center, media_player.living_room_sp, media_player.dining_room, media_player.kitchen, media_player.bathroom, media_player._USER1_s_office, media_player._USER2_s_office, media_player.basement'
          volume: '1'
          what: 'You are not Authorized to be Here'

        ##########################################################
        ## Water Sensor Audio Notification
        ##########################################################

- alias: Basement Water Sensor Audio Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.media_center, media_player.living_room_sp, media_player.dining_room, media_player.kitchen, media_player.bathroom, media_player._USER1_s_office, media_player._USER2_s_office, media_player.basement'
          volume: '.9'
          what: 'Water Detected in Basement'

        ##########################################################
        ## Front Door Bell Bathroom Audio Notification
        ##########################################################

- alias: Front Door Bell Bathroom Audio Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: binary_sensor.bathroom_occupancy
      state: 'on'

  action:
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.bathroom'
          where: 'media_player.bathroom'
          volume: '.6'
          what: 'Someone is at the Front Door'

        ##########################################################
        ## Front Door Bell Basement Audio Notification
        ##########################################################

- alias: Front Door Bell Basement Audio Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: group.basement
      state: 'on'

  action:
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.baement'
          where: 'media_player.basement'
          volume: '.5'
          what: 'Someone is at the Front Door'

        ##########################################################
        ## Front Door Bell Office Audio Notification
        ##########################################################

- alias: Front Door Bell Office Audio Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door_button_pressed
      from: 'off'
      to: 'on'

  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.household
        state: 'home'
      - condition: state
        entity_id: input_boolean.disable_voice_greeting
        state: 'off'
      - condition: or
        conditions:
          - condition: state
            entity_id: binary_sensor.office_occupancy
            state: 'on'
          - condition: state
            entity_id: binary_sensor._USER2_office_occupancy
            state: 'on'

  action:
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player._USER1_s_office'
          where: 'media_player._USER1_s_office, media_player._USER2_s_office'
          volume: '.5'
          what: 'Someone is at the Front Door'

        ##########################################################
        ## Welcome Home _USER1_ Audio Greeting
        ##########################################################

- alias: Welcome Home _USER1_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'
    - condition: state
      entity_id: input_boolean._USER1_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:03'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome Home _USER1_'
    - delay: '00:02:00'
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER1_greeting

        ##########################################################
        ## Notify _USER2_s Office that _USER1_ is Home
        ##########################################################

- alias: Notify _USER2_s Office that _USER1_ is Home

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'
    - condition: state
      entity_id: input_boolean._USER1_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean._USER2_greeting
      state: 'off'
    - condition: state
      entity_id: binary_sensor._USER2_office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:60'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player._USER2_s_office'
          where: 'media_player._USER2_s_office'
          volume: '.5'
          what: '_USER1_ is Home'

        ##########################################################
        ## Welcome Home _USER2_ Audio Greeting
        ##########################################################

- alias: Welcome Home _USER2_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'
    - condition: state
      entity_id: input_boolean._USER2_greeting
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:07'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome Home _USER2_'
    - delay: '00:02:00'
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER2_greeting

        ##########################################################
        ## Notify _USER1_s Office that _USER2_ is Home
        ##########################################################

- alias: Notify _USER1_s Office that _USER2_ is Home

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'home'
    - condition: state
      entity_id: input_boolean._USER1_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._USER2_greeting
      state: 'on'
    - condition: state
      entity_id: binary_sensor.office_occupancy
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:60'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player._USER1_s_office'
          where: 'media_player._USER1_s_office'
          volume: '.5'
          what: '_USER2_ is Home'

        #################################################################
        ## _USER2_ Left Work Audio Notification
        #################################################################

- alias: _USER2_ Left Work Audio Notification

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'work'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: device_tracker._USER1_
      state: 'home'
    - condition: state
      entity_id: device_tracker._USER2_
      state: 'not_home'
    - condition: state
      entity_id: input_boolean._USER2_away
      state: 'on'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - service: media_player.sonos_snapshot
      data:
        with_group: yes
    - delay: '00:00:02'
    - service: media_player.sonos_unjoin
      entity_id:
        - media_player.living_room_sp
        - media_player.dining_room
        - media_player.kitchen
        - media_player.bathroom
        - media_player._USER1_s_office
    - delay: '00:00:01'
    - service: media_player.sonos_join
      data:
        master: media_player._USER1_s_office
      entity_id:
        - media_player.living_room_sp
        - media_player.dining_room
        - media_player.kitchen
        - media_player.bathroom
        - media_player._USER1_s_office
    - delay: '00:00:01'
    - service: media_player.volume_set
      entity_id: media_player._USER1_s_office
      data:
        volume_level: .6
    - delay: '00:00:01'
    - service: tts.google_say
      data_template:
        entity_id: media_player._USER1_s_office
        message: "_USER2_ has left work and will arrive Home in about {{states('sensor._USER2_to_home')}} minutes"
    - delay: '00:00:20'
    - service: media_player.sonos_restore
      data:
        with_group: yes

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._GUEST_
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._GUEST_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:09'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_, please remove your shoes'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._GUEST_siphone
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._GUEST_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:08'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._GUEST_siphone3
      state: 'home'
    - condition: state
      entity_id: input_boolean._USER1_away
      state: 'off'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._GUEST_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:08'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._GUEST_siphone
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._GUEST_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:08'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker.johnsiphone2
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean._GUEST_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:08'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## _GUEST_ Audio Greeting
        ##########################################################

- alias: Welcome _GUEST_ Audio Notification

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: device_tracker._GUEST_
      state: 'home'
    - condition: state
      entity_id: input_boolean.disable_voice_greeting
      state: 'off'
    - condition: state
      entity_id: input_boolean.more_visiting
      state: 'off'
    - condition: time
      after: '09:00'
      before: '22:00'

  action:
    - delay: '00:00:10'
    - service: script.turn_on
      entity_id: script.say
      data:
        variables:
          master: 'media_player.living_room_sp'
          where: 'media_player.living_room_sp, media_player.dining_room, media_player.kitchen'
          volume: '.5'
          what: 'Welcome _GUEST_ eh.  Hello _GUEST_'
    - delay: '00:00:30'
    - service: homeassistant.turn_on
      entity_id: input_boolean.more_visiting

#################################################################
## Friends and Family Visiting
#################################################################

        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hours
        ##########################################################

- alias: Set _GUEST_ as No Longer Visiting after 1.5 Hours

  trigger:
    - platform: state
      entity_id: device_tracker.thomassiphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hour
        ##########################################################

- alias: Set _GUEST_ as No Longer Visiting after 1.5 Hour

  trigger:
    - platform: state
      entity_id: device_tracker._GUEST_siphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting


        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hours
        ##########################################################

- alias: Set _GUEST_ as No Longer Visiting after 1.5 Hours

  trigger:
    - platform: state
      entity_id: device_tracker._GUEST_siphone3
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hours
        ##########################################################

- alias: Set _GUEST_ as No Longer Visiting after 1.5 Hours

  trigger:
    - platform: state
      entity_id: device_tracker._GUEST_siphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hours
        ##########################################################

- alias: Set _GUEST_ as No Longer Visiting after 1.5 Hours

  trigger:
    - platform: state
      entity_id: device_tracker.johnsiphone2
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting

        ##########################################################
        ## Set _GUEST_ as No Longer Visiting after 1.5 Hours
        ##########################################################

- alias: Set More as No Longer Visiting after 1.5 Hours

  trigger:
    - platform: state
      entity_id: device_tracker.moresuensiphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 1
        minutes: 30
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._GUEST_visiting

#################################################################
## Water Sensors
#################################################################

        ##########################################################
        ## Send Notification for Water Detected
        ##########################################################

- alias: Basement Water Sensor Send Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Water Detected in Basement!

- alias: Sump Pump Water Sensor Send Notification

  trigger:
    - platform: state
      entity_id: binary_sensor.sump_pump_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  action:
    - service: notify.ios_USER1_s_iphone
      data:
        message: Water Detected in Sump Pump!

        ##########################################################
        ## Sound Alarm When Water Detected
        ##########################################################

- alias: Sound Alarm When Water Detected

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: switch.turn_on
      entity_id: switch.siren

        ##########################################################
        ## Flash Lights when Water Detected
        ##########################################################

- alias: Sound Alarm When Water Detected

  trigger:
    - platform: state
      entity_id: binary_sensor.basement_drain_water_sensor_liquid_detected
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: light.turn_on
      entity_id: group.hue_lights
      data:
       brightness: 255
       color_name: blue
       flash: long

#################################################################
## Sonos
#################################################################

- alias: Ungroup Sonos Every Morning

  trigger:
    - platform: time
      after: '06:00'

  action:
    - service: media_player.sonos_unjoin
      entity_id:
        - media_player.media_center
        - media_player.living_room_sp
        - media_player.dining_room
        - media_player.kitchen
        - media_player.bathroom
        - media_player._USER1_s_office
        - media_player._USER2_s_office
        - media_player.basement

#################################################################
## Work Arounds
#################################################################

        ##########################################################
        ## Disable Alarm when Home
        ##########################################################

- alias: Disable Alarm when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.enable_security

        ##########################################################
        ## Enable Alarm when Away
        ##########################################################

- alias: Enable Alarm when Away

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean.enable_security

        ##########################################################
        ## Set _USER1_ Away Driving
        ##########################################################

- alias: Set _USER1_ Away Driving

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER1_away_driving

        ##########################################################
        ## Set _USER1_ Away after 1 Min
        ##########################################################

- alias: Set _USER1_ Away after 1 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER1_away
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER1_greeting

        ##########################################################
        ## Set _USER1_ Home after 10 Mins
        ##########################################################

- alias: Set _USER1_ Home after 10 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._USER1_
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER1_away, input_boolean._USER1_away_driving, input_boolean._USER1_greeting

        ##########################################################
        ## Set _USER2_ Away Driving
        ##########################################################

- alias: Set _USER2_ Away Driving

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: cover.garage_door
      state: 'open'

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER2_away_driving

        ##########################################################
        ## Set _USER2_ Away after 1 Min
        ##########################################################

- alias: Set _USER2_ Away after 1 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  action:
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER2_away
    - service: homeassistant.turn_on
      entity_id: input_boolean._USER2_greeting

        ##########################################################
        ## Set _USER2_ Home after 10 Mins
        ##########################################################

- alias: Set _USER2_ Home after 10 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._USER2_
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER2_away, input_boolean._USER2_away_driving, input_boolean._USER2_greeting

        ##########################################################
        ## Manually Set _USER1_ Home
        ##########################################################

- alias: Manually Set _USER1_ Home

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_home
      from: 'off'
      to: 'on'

  action:
    - service: device_tracker.see
      data:
        dev_id: _USER1_
        location_name: 'home'

- alias: Reset _USER1_ Home

  trigger:
    - platform: state
      entity_id: input_boolean._USER1_home
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER1_home

        ##########################################################
        ## Manually Set _USER1_ Away
        ##########################################################

- alias: Manually Set _USER1_ Away

  trigger:
    - platform: state
      entity_id: input_boolean.manual_USER1_away
      from: 'off'
      to: 'on'

  action:
    - service: device_tracker.see
      data:
        dev_id: _USER1_
        location_name: 'not_home'

- alias: Reset Manually Set _USER1_ Away

  trigger:
    - platform: state
      entity_id: input_boolean.manual_USER1_away
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.manual_USER1_away

        ##########################################################
        ## Manually Set _USER2_ Home
        ##########################################################

- alias: Manually Set _USER2_ Home

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_home
      from: 'off'
      to: 'on'

  action:
    - service: device_tracker.see
      data:
        dev_id: _USER2_
        location_name: 'home'

- alias: Reset _USER2_ Home

  trigger:
    - platform: state
      entity_id: input_boolean._USER2_home
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean._USER2_home

        ##########################################################
        ## Manually Set _USER2_ Away
        ##########################################################

- alias: Manually Set _USER2_ Away

  trigger:
    - platform: state
      entity_id: input_boolean.manual_USER2_away
      from: 'off'
      to: 'on'

  action:
    - service: device_tracker.see
      data:
        dev_id: _USER2_
        location_name: 'not_home'

- alias: Reset _USER2_ Home

  trigger:
    - platform: state
      entity_id: input_boolean.manual_USER2_away
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 30

  action:
    - service: homeassistant.turn_off
      entity_id: input_boolean.manual_USER2_away

        ##########################################################
        ## Turn off Back Patio Twice
        ##########################################################

- alias: Turn off Back Patio Twice

  trigger:
    - platform: state
      entity_id: group.back_door
      from: 'on'
      to: 'off'

  action:
    - delay: 00:00:90
    - service: light.turn_off
      entity_id: light.upper_patio_left, light.upper_patio_right

        ##########################################################
        ## Turn off Back Door Twice
        ##########################################################

- alias: Turn off Back Door Twice

  trigger:
    - platform: state
      entity_id: group.back_porch
      from: 'on'
      to: 'off'

  action:
    - delay: 00:03:00
    - service: light.turn_off
      entity_id: group.back_door

        ##########################################################
        ## Turn on Lower BackYard after Patio
        ##########################################################

- alias: Turn on Lower BackYard after Patio

  trigger:
    - platform: state
      entity_id: switch.lower_patio_outdoor_lighting
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 0
        seconds: 90

  action:
    - service: switch.turn_on
      entity_id: switch.lower_backyard_outdoor_lighting

        ##########################################################
        ## Save Current States
        ##########################################################

- alias: Save Current States

  trigger:
    - platform: state
      entity_id: input_boolean.lights_morning_disable
    - platform: state
      entity_id: input_boolean.thermostat_away
    - platform: state
      entity_id: input_boolean._USER1_away
    - platform: state
      entity_id: input_boolean._USER1_away_driving
    - platform: state
      entity_id: input_boolean._USER1_greeting
    - platform: state
      entity_id: input_boolean._USER2_away
    - platform: state
      entity_id: input_boolean._USER2_away_driving
    - platform: state
      entity_id: input_boolean._USER2_greeting
    - platform: state
      entity_id: input_boolean.enable_security
    - platform: state
      entity_id: input_boolean.vacation_mode
    - platform: state
      entity_id: input_boolean.home_away
    - platform: state
      entity_id: input_boolean.garage_door
    - platform: state
      entity_id: input_select.holiday
    - platform: state
      entity_id: input_select.remote
    - platform: state
      entity_id: device_tracker._USER1_
    - platform: state
      entity_id: device_tracker._USER2_

  action:
    - service: shell_command.export_ha_states
      data_template:
        section: '{{ trigger.entity_id }}'
        settings: '{{ trigger.entity_id }}'
        value: "{{ trigger.to_state.state }}"

        ##########################################################
        ## Load States on Startup
        ##########################################################

- alias: Load Previous States

  trigger:
    - platform: event
      event_type: homeassistant_start

  action:
    - delay: 00:01:30
    - service: shell_command.import_ha_states

##########################################################
## Basement Heater
##########################################################

        ##########################################################
        ## Turn on Basement Heater when Cold
        ##########################################################

- alias: Turn on Basement Heater when Cold

  trigger:
    - platform: numeric_state
      entity_id: sensor.basement_temperature
      below: 55

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    - service: switch.turn_on
      entity_id: switch.basement_heater

        ##########################################################
        ## Turn off Basement Heater when Warm
        ##########################################################

- alias: Turn off Basement Heater when Warm

  trigger:
    - platform: numeric_state
      entity_id: sensor.basement_temperature
      above: 57

  action:
    - service: switch.turn_off
      entity_id: switch.basement_heater

        ##########################################################
        ## Turn on Basement Heater when Home
        ##########################################################

- alias: Turn on Basement Heater when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.basement_temperature
      below: 55

  action:
    - service: switch.turn_on
      entity_id: switch.basement_heater

        ##########################################################
        ## Heater Bedtime
        ##########################################################

- alias: Heater Bedtime

  trigger:
    - platform: state
      entity_id: input_boolean.bedtime
      state: 'on'
      for:
        hours: 0
        minutes: 1
        seconds: 0

  condition:
    - condition: numeric_state
      entity_id: sensor.basement_temperature
      above: 55

  action:
    - service: switch.turn_off
      entity_id: switch.basement_heater
