#################################################################
## Automations
#################################################################

        ##########################################################
        ## _REDACTED_ Home Unlock Doors
        ##########################################################

- alias: _REDACTED_ Home Unlock Doors

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._REDACTED__away
      state: 'on'
  
  action:
    service: lock.unlock
    entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## After _REDACTED_ Home Lock Doors
        ########################################################

- alias: _REDACTED_ Home Lock Doors

  trigger:
    - platform: state
      entity_id: input_boolean._REDACTED__away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'
    - condition: state
      entity_id: binary_sensor.back_door
      state: 'off'
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  action:
    service: lock.lock
    entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## _REDACTED_ Home Unlock Doors
        ##########################################################

- alias: _REDACTED_ Home Unlock Doors

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._REDACTED__away
      state: 'on'

  action:
    service: lock.unlock
    entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## After _REDACTED_ Home Lock Doors
        ########################################################

- alias: _REDACTED_ Home Lock Doors

  trigger:
    - platform: state
      entity_id: input_boolean._REDACTED__away
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'
    - condition: state
      entity_id: binary_sensor.back_door
      state: 'off'
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  action:
    service: lock.lock
    entity_id: lock.back_door, lock.front_door

        ##########################################################
        ## Away Mode
        ##########################################################

- alias: Away Mode

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    - service: lock.lock
      entity_id: group.all_locks
    - service: light.turn_off
      entity_id: group.interior_lights
    - service: switch.turn_off
      entity_id: switch.air_purifier

        ##########################################################
        ## _REDACTED_ Home Turn on Lights
        ##########################################################

- alias: _REDACTED_ Home

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._REDACTED__away
      state: 'on'

  action:
    service: light.turn_on
    entity_id: group.home_lights
    data:
     xy_color: [ 0.5134, 0.4149 ]
     brightness: 150

        ##########################################################
        ## _REDACTED_ Home Turn on Lights
        ##########################################################

- alias: _REDACTED_ Home

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'
    - condition: state
      entity_id: input_boolean._REDACTED__away
      state: 'on'

  action:
    service: light.turn_on
    entity_id: group.home_lights
    data:
     xy_color: [ 0.5134, 0.4149 ]
     brightness: 150

        ##########################################################
        ## Plex Lights On/Off
        ##########################################################

- alias: "Media player paused/stopped"

  trigger:
    - platform: state
      entity_id: media_player.living_room
      from: 'playing'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.plex_lights_disable
      state: 'off'

  action:
    - service: light.turn_on
      entity_id: group.living_room_lamps
      data:
       transition: 3
       profile: relax
    - service: light.turn_on
      entity_id: light.hallway_light
      data:
       brightness: 25
    - service: light.turn_on
      entity_id: light.dining_room_table, light.kitchen_cabinets, light.kitchen_sink
      data:
       brightness: 100

- alias: "Media player playing"

  trigger:
       - platform: state
         entity_id: media_player.living_room
         to: 'playing'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.plex_lights_disable
      state: 'off'

  action:
    - service: light.turn_off
      entity_id: group.living_room_lamps, light.hallway_light
      data:
       transition: 3
    - service: light.turn_off
      entity_id: group.dining_room, group.kitchen

        ##########################################################
        ## Set Thermostat Away/Home
        ##########################################################

- alias: Thermostat - Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'
  
  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    entity_id: thermostat.main_floor
    service: thermostat.set_away_mode
    data:
      away_mode: 'False'

- alias: Thermostat - Away

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: input_boolean.home_away
      state: 'off'

  action:
    entity_id: thermostat.main_floor
    service: thermostat.set_away_mode
    data:
      away_mode: 'True'

        ##########################################################
        ## Turn On Front Porch when Door Opens
        ##########################################################

- alias: Turn on Front Porch when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group.front_porch
    data:
      brightness: 255

        ##########################################################
        ## Reset Front Door Brightness when Door Closes
        ##########################################################

- alias: Reset Front Porch Brightness when Door Closes

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door
      from: 'on'
      to: 'off'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group.front_porch
    data:
      brightness: 50

        ##########################################################
        ## Turn On Living Room when Door Opens
        ##########################################################

- alias: Turn on Front Porch when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.front_door
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group.living_room
    data:
     xy_color: [ 0.5134, 0.4149 ]
     brightness: 255

        ##########################################################
        ## Turn On Back Door when Door Opens
        ##########################################################

- alias: Turn on Back Door when Door Opens

  trigger:
    - platform: state
      entity_id: binary_sensor.back_door
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.door_open_lights_on
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group.back_door
    data:
     brightness: 150

        ##########################################################
        ## Lock Front Door After 30 Mins
        ##########################################################
      
- alias: 'Lock Front Door After 30 Mins'

  trigger:  
    - platform: state
      entity_id: lock.front_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 30
        seconds: 0
  
  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.front_door
      state: 'off'
    - condition: state
      entity_id: lock.front_door
      state: 'unlocked'    
  
  action:
    service: lock.lock
    entity_id: lock.front_door

        ##########################################################
        ## Lock Back Door After 2 Hours
        ##########################################################
      
- alias: 'Lock Front Door After 2 Hours'

  trigger:  
    - platform: state
      entity_id: lock.back_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 2
        minutes: 0
        seconds: 0
  
  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door
      state: 'off'
      for:
        hours: 1
        minutes: 0
        seconds: 0
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'   

  action:
    service: lock.lock
    entity_id: lock.back_door

        ##########################################################
        ## Lock Basement Door After 45 Mins
        ##########################################################

- alias: 'Lock Basement Door After 45 Mins'

  trigger:
    - platform: state
      entity_id: lock.basement_door
      from: 'locked'
      to: 'unlocked'
      for:
        hours: 0
        minutes: 45
        seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.basement_door
      state: 'off'
    - condition: state
      entity_id: lock.basement_door
      state: 'unlocked'

  action:
    service: lock.lock
    entity_id: lock.basement_door

        ##########################################################
        ## Lock Back Door when _REDACTED_ Leaves in the Morning
        ##########################################################

- alias: Lock Back Door when _REDACTED_ Leaves

  trigger:
     - platform: state
       entity_id: device_tracker._REDACTED_siphone
       from: 'home'
       to: 'not_home'

  condition:
    - condition: time
      after: '05:00'
      before: '07:00'
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: binary_sensor.back_door
      state: 'off'
    - condition: state
      entity_id: lock.back_door
      state: 'unlocked'

  action:
    service: lock.lock
    entity_id: lock.back_door

        ##########################################################
        ## Lock Doors at 2a
        ##########################################################
      
- alias: 'Lock Doors at 2a'

  trigger:
    - platform: time
      after: '02:00'
  
  condition:
    - condition: state
      entity_id: input_boolean.disable_lock_unlock_doors
      state: 'off'
    - condition: state
      entity_id: group.doors
      state: 'off'
  
  action:
    service: lock.lock
    entity_id: group.all_locks


        ##########################################################
        ## Turn On Front Porch at Sunset
        ##########################################################

- alias: Turn on Front Porch at Sunset

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:05:00'

  condition:
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'

  action:
    service: light.turn_on
    entity_id: group.front_porch
    data:
    # 900 seconds = 15 minutes
      transition: 300
      brightness: 50

        ##########################################################
        ## Turn Off Front Porch at 10:00 pm
        ##########################################################

- alias: Turn Off Front Porch at 10p

  trigger:
   - platform: time
     after: '22:00'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'

  action:
    service: light.turn_off
    entity_id: group.front_porch

        ##########################################################
        ## Turn on Back Door at Sunset when _REDACTED_ Leaves Work
        ##########################################################

- alias: Turn on Back Door at Sunset

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'work'
      to: 'not_home'

  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.exterior_on_sunset
      state: 'off'

  action:
    service: light.turn_on
    entity_id: group.back_door
    data:
     brightness: 200

        ##########################################################
        ## Turn Off Back Door at 9:30 pm
        ##########################################################

- alias: Back Door Off at 9:30p

  trigger:
    - platform: time
      after: '21:30'
     
  condition:
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.exterior_off_night
      state: 'off'

  action:
   service: light.turn_off
   entity_id: group.back_door

        ##########################################################
        ## Turn on Back Door at 5:00a if _REDACTED_ Home
        ##########################################################

- alias: Back Door on at 5a

  trigger:
    - platform: time
      after: '05:00'

  condition:
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.lights_morning_disable
      state: 'off'

  action:
    service: light.turn_on
    entity_id: group.back_door
    data:
     brightness: 200

        ##########################################################
        ## Turn on Lights at 5a if _REDACTED_ Home
        ##########################################################

- alias: Turn on Interior Lights at 5a

  trigger:
    - platform: time
      after: '05:00'

  condition:
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'
    - condition: state
      entity_id: sun.sun
      state: 'below_horizon'
    - condition: state
      entity_id: input_boolean.lights_morning_disable
      state: 'off'

  action:
    service: light.turn_on
    entity_id: light.dining_room_table, light.kitchen_cabinets, group.living_room
    data:
     brightness: 15
     xy_color: [ 0.5134, 0.4149 ]

        ##########################################################
        ## Turn off Lights when _REDACTED_ Leaves
        ##########################################################

- alias: Turn off Lights when _REDACTED_ Leaves

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'home'
      to: 'not_home'
  
  condition:
    - condition: time
      after: '05:00'
      before: '07:00'
    - condition: state
      entity_id: input_boolean.lights_away
      state: 'off'

  action:
    service: light.turn_off
    entity_id: group.interior_lights, group.back_door

        ##########################################################
        ## Turn off Lights at Sunrise
        ##########################################################

- alias: Turn off Lights at Sunrise

  trigger:
    - platform: sun
      event: 'sunrise'
      offset: '+00:15:00'

  action:
    service: light.turn_off
    entity_id: group.interior_lights, group.exterior_lights


        ##########################################################
        ## Turn on Office Air Purifier when Occupied
        ##########################################################

- alias: Turn on Office Air Purifier when Occupied

  trigger:
    - platform: state
      entity_id: sensor.office_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_air_purifier_on_off_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'         

  action:
    service: switch.turn_on
    entity_id: switch.air_purifier

        ##########################################################
        ## Turn off Office Air Purifier when Unoccupied
        ##########################################################

- alias: Turn off Office Air Purifier when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.office_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_air_purifier_on_off_disable
      state: 'off'     

  action:
    service: switch.turn_off
    entity_id: switch.air_purifier

        ##########################################################
        ## Turn off Office when Unoccupied
        ##########################################################

- alias: Turn off Office Light when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.office_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         


  action:
    service: light.turn_off
    entity_id: group._REDACTED__office

        ##########################################################
        ## Turn off _REDACTED_ Office when Unoccupied
        ##########################################################

- alias: Turn off _REDACTED_ Office Light when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor._REDACTED__office_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: group._REDACTED__office

        ##########################################################
        ## Turn off Bedroom when Unoccupied
        ##########################################################

- alias: Turn off Bedroom Light when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.bedroom_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: group.bedroom

        ##########################################################
        ## Turn off Kitchen when Unoccupied
        ##########################################################

- alias: Turn off Kitchen Light when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.kitchen_occupancy
      from: 'true'
      to: 'false'
  
  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: group.kitchen

        ##########################################################
        ## Turn off Dining Room / Hallway when Unoccupied
        ##########################################################

- alias: Turn off Dining Room when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.main_floor_occupancy
      from: 'true'
      to: 'false'
         
  condition:
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: light.hallway_light, group.dining_room

        ##########################################################
        ## Turn off Living Room when Unoccupied
        ##########################################################

- alias: Turn off Living Room when Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.living_room_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: sensor.main_floor_occupancy
      state: 'false'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'                  

  action:
    service: light.turn_off
    entity_id: group.living_room

        ##########################################################
        ## Turn off Stairs when Unoccupied
        ##########################################################

- alias: Turn off Stairs when _REDACTED_ Unoccupied

  trigger:
    - platform: state
      entity_id: sensor.office_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: sensor._REDACTED__office_occupancy
      state: 'false'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: group.stairs

- alias: Turn off Stairs when _REDACTED_ Office Unoccupied

  trigger:
    - platform: state
      entity_id: sensor._REDACTED__office_occupancy
      from: 'true'
      to: 'false'

  condition:
    - condition: state
      entity_id: sensor.office_occupancy
      state: 'false'
    - condition: state
      entity_id: input_boolean.occupancy_lights_off_disable
      state: 'off'         

  action:
    service: light.turn_off
    entity_id: group.stairs

        ##########################################################
        ## Turn on Living Room / Dining Room at Sunset when Occupied
        ##########################################################

- alias: Turn on Lights at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:59:00'

  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: sensor.main_floor_occupancy
        state: 'true'
      - condition: state
        entity_id: sensor.living_room_occupancy
        state: 'true'
      - condition: state
        entity_id: group.household
        state: 'home'

  action:
    service: light.turn_on
    entity_id: group.living_room, light.dining_room_table
    data:
    # 900 seconds = 15 minutes
      transition: 3600
      xy_color: [ 0.5134, 0.4149 ]
      brightness: 255


        ##########################################################
        ## Turn on Office at Sunset when Occupied
        ##########################################################

- alias: Turn on Office Lights at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:10:00'

  condition:
    - condition: state
      entity_id: sensor.office_occupancy
      state: 'true'
    - condition: state
      entity_id: input_boolean.office_lights_sunset
      state: 'off'
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group._REDACTED__office
    data:
    # 900 seconds = 15 minutes
      transition: 1200
      brightness: 75

        ##########################################################
        ## Turn on _REDACTED_'s Office at Sunset when Occupied
        ##########################################################

- alias: Turn on _REDACTED_ Office Lights at Sunset when Occupied

  trigger:
    - platform: sun
      event: 'sunset'
      offset: '-00:10:00'

  condition:
    - condition: state
      entity_id: sensor._REDACTED__office_occupancy
      state: 'true'
    - condition: state
      entity_id: input_boolean.office_lights_sunset
      state: 'off'
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group._REDACTED__office
    data:
    # 900 seconds = 15 minutes
      transition: 1200
      brightness: 75

        ##########################################################
        ## Turn On/Off First Floor Lights During Rain
        ##########################################################

- alias: Rainy Day First Floor

  trigger:
    - platform: state
      entity_id: sensor.weather_precip
      state: 'rain'

  condition:
    - condition: state
      entity_id: group.household
      state: 'home'
    - condition: time
      after: '09:00'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: sensor.main_floor_occupancy
      state: 'true'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: group.household
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group.rain_lights
    data:
     xy_color: [ 0.5134, 0.4149 ]
     brightness: 50

#- alias: Rain is over First Floor
#  
#  trigger:
#    - platform: state
#      entity_id: sensor.weather_precip
#      state: 'unknown'
#  
#  condition:
#    - condition: state
#      entity_id: sun.sun
#      state: 'above_horizon'
#         
#  action:
#    service: light.turn_off
#    entity_id: group.rain_lights

        ##########################################################
        ## Turn On/Off _REDACTED_ Office During Rain
        ##########################################################

- alias: Rainy Day _REDACTED_ Office

  trigger:
    - platform: state
      entity_id: sensor.weather_precip
      state: 'rain'

  condition:
    - condition: state
      entity_id: sensor._REDACTED__office_occupancy
      state: 'true'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group._REDACTED__office
    data:
     brightness: 50

#- alias: Rain is over _REDACTED_ Office
#  
#  trigger:
#    - platform: state
#      entity_id: sensor.weather_precip
#      state: 'unknown'
#
#  condition:
#    - condition: state
#      entity_id: sun.sun
#      state: 'above_horizon'
#
#  condition: use_trigger_values
#  action:
#    service: light.turn_off
#    entity_id: group._REDACTED__office, group.stairs

        ##########################################################
        ## Turn On/Off _REDACTED_ Office During Rain
        ##########################################################

- alias: Rainy Day _REDACTED_ Office

  trigger:
    - platform: state
      entity_id: sensor.weather_precip
      state: 'rain'

  condition:
    - condition: state
      entity_id: sensor.office_occupancy
      state: 'true'
    - condition: state
      entity_id: sun.sun
      state: 'above_horizon'
    - condition: state
      entity_id: input_boolean.rainy_day_disable
      state: 'off'
    - condition: state
      entity_id: device_tracker._REDACTED_siphone
      state: 'home'

  action:
    service: light.turn_on
    entity_id: group._REDACTED__office, group.stairs
    data:
     brightness: 30
     xy_color: [0.139,0.081]

#- alias: Rain is over _REDACTED_ Office
#  
#  trigger:
#    - platform: state
#      entity_id: sensor.weather_precip
#      state: 'None'
#
#  condition:
#    - condition: state
#      entity_id: sun.sun
#      state: 'above_horizon'
#
#  action:
#    service: light.turn_off
#    entity_id: group._REDACTED__office, group.stairs

        ##########################################################
        ## Security
        ##########################################################

- alias: Security Main Floor

  trigger:
    - platform: state
      entity_id: sensor.main_floor_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security
     
- alias: Security Living Room

  trigger:
    - platform: state
      entity_id: sensor.living_room_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security
     
- alias: Security Kitchen

  trigger:
    - platform: state
      entity_id: sensor.kitchen_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security
     
- alias: Security Bedroom

  trigger:
    - platform: state
      entity_id: sensor.bedroom_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security
      
- alias: Security Office

  trigger:
    - platform: state
      entity_id: sensor.office_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security
      
- alias: Security _REDACTED_ Office

  trigger:
    - platform: state
      entity_id: sensor._REDACTED__office_occupancy
      from: 'false'
      to: 'true'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security

- alias: Security Door Open

  trigger:
    - platform: state
      entity_id: group.doors
      from: 'off'
      to: 'on'

  condition:
    - condition: state
      entity_id: group.household
      state: 'not_home'
    - condition: state
      entity_id: input_boolean.disable_security
      state: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.security

        ##########################################################
        ## On Demand Automation
        ##########################################################

- alias: 'Set Living Room to Random Color'

  trigger:
    - platform: time
      minutes: '/2'
      seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.livingroom_rainbow
      state: 'on'

  action:
    service: light.turn_on
    entity_id: group.living_room
    data:
      effect: random
      transition: 5
      brightness: 255

- alias: 'Set Office to Random Color'

  trigger:
    - platform: time
      minutes: '/2'
      seconds: 0

  condition:
    - condition: state
      entity_id: input_boolean.office_rainbow
      state: 'on'

  action:
    service: light.turn_on
    entity_id: light.office_lamp
    data:
      effect: random
      transition: 5
      brightness: 255

- alias: Lock Doors on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.lock_doors
      state: 'on'

  action:
    service: lock.lock
    entity_id: group.all_locks

- alias: Reset Lock Doors Switch

  trigger:
    - platform: state
      entity_id: input_boolean.lock_doors
      from: 'off'
      to: 'on'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  action:
    service: homeassistant.turn_off
    entity_id: input_boolean.lock_doors

- alias: Unlock Doors on Demand

  trigger:
    - platform: state
      entity_id: input_boolean.unlock_doors
      state: 'on'

  action:
    service: lock.unlock
    entity_id: group.all_locks

- alias: Reset Unlock Doors Switch

  trigger:
     - platform: state
       entity_id: input_boolean.unlock_doors
       from: 'off'
       to: 'on'
       for:
         hours: 0
         minutes: 5
         seconds: 0

  action:
    service: homeassistant.turn_off
    entity_id: input_boolean.unlock_doors

- alias: Thermostat On Demand Home

  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_away
      from: 'on'
      to: 'off'

  action:
    entity_id: thermostat.main_floor
    service: thermostat.set_away_mode
    data:
      away_mode: 'False'

- alias: Thermostat On Demand Away

  trigger:
    - platform: state
      entity_id: input_boolean.thermostat_away
      from: 'off'
      to: 'on'

  action:
    entity_id: thermostat.main_floor
    service: thermostat.set_away_mode
    data:
      away_mode: 'True'


- alias: Panic Mode

  trigger:
    - platform: state
      entity_id: input_boolean.panic_mode
      state: 'on'

  action:
    service: scene.turn_on
    entity_id: scene.security

        ##########################################################
        ## Vacation Mode
        ##########################################################

- alias: Vacation Mode

  trigger:
    - platform: state
      entity_id: sun.sun
      from: 'above_horizon'
      to: 'below_horizon'

  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  action:
    service: scene.turn_on
    entity_id: scene.vacation

- alias: Vacation Mode Lights Off

  trigger:
    - platform: time
      after: '01:12'

  condition:
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'on'

  action:
   service: light.turn_off
   entity_id: light.office_ceiling, light.basement_stairs, group.living_room, light.closet_lamp
   
- alias: Vacation Mode Disable Automation

  trigger:
    - platform: state
      entity_id: input_boolean.vacation_mode
      from: 'off'
      to: 'on'
      
  action:
    service: scene.turn_on
    entity_id: scene.vacation_disable_automation

- alias: Vacation Mode Enable Automation

  trigger:
    - platform: state
      entity_id: input_boolean.vacation_mode
      from: 'on'
      to: 'off'

  action:
    service: scene.turn_on
    entity_id: scene.vacation_enable_automation

        ##########################################################
        ## Notifications
        ##########################################################

- alias: Security Notify

  trigger:
    - platform: state
      entity_id: input_boolean.alarm_tripped
      from: 'off'
      to: 'on'

  action:
    service: notify.text_message
    data:
      message: 'Alarm Has Been Tripped!'
      target:
        - _REDACTED_

- alias: Alarm Enabled Notify

  trigger:
    - platform: state
      entity_id: input_boolean.disable_security
      to: 'off'

  action:
    service: notify.text_message
    data:
      message: 'Alarm Enabled'
      target:
        - _REDACTED_

- alias: Alarm Disabled Notify

  trigger:
    - platform: state
      entity_id: input_boolean.disable_security
      to: 'on'

  action:
    service: notify.text_message
    data:
      message: 'Alarm Disabled'
      target:
        - _REDACTED_

- alias: _REDACTED_ Message Away

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'home'
      to: 'not_home'

  action:
    service: notify.text_message
    data:
      message: '_REDACTED_ Phone Away State'
      target:
        - _REDACTED_

- alias: _REDACTED_ Message Home

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'

  action:
    service: notify.text_message
    data:
      message: '_REDACTED_ Phone Home State'
      target:
        - _REDACTED_ 

#################################################################
## Work Arounds
#################################################################

        ##########################################################
        ## Disable Alarm when Home
        ##########################################################

- alias: Disable Alarm when Home

  trigger:
    - platform: state
      entity_id: group.household
      from: 'not_home'
      to: 'home'

  action:
    service: homeassistant.turn_on
    entity_id: input_boolean.disable_security

        ##########################################################
        ## Enable Alarm when Away
        ##########################################################

- alias: Enable Alarm when Away

  trigger:
    - platform: state
      entity_id: group.household
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 10
        seconds: 0

  action:
    service: homeassistant.turn_off
    entity_id: input_boolean.disable_security

        ##########################################################
        ## Set _REDACTED_ Away after 5 Mins
        ##########################################################

- alias: Set _REDACTED_ Away after 5 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  action:
    service: homeassistant.turn_on
    entity_id: input_boolean._REDACTED__away
    
        ##########################################################
        ## Set _REDACTED_ Home after 15 Mins
        ##########################################################

- alias: Set _REDACTED_ Home after 15 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  action:
    service: homeassistant.turn_off
    entity_id: input_boolean._REDACTED__away
    
        ##########################################################
        ## Set _REDACTED_ Away after 5 Mins
        ##########################################################

- alias: Set _REDACTED_ Away after 5 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'home'
      to: 'not_home'
      for:
        hours: 0
        minutes: 5
        seconds: 0

  action:
    service: homeassistant.turn_on
    entity_id: input_boolean._REDACTED__away
    
        ##########################################################
        ## Set _REDACTED_ Home after 15 Mins
        ##########################################################

- alias: Set _REDACTED_ Home after 15 Mins

  trigger:
    - platform: state
      entity_id: device_tracker._REDACTED_siphone
      from: 'not_home'
      to: 'home'
      for:
        hours: 0
        minutes: 15
        seconds: 0

  action:
    service: homeassistant.turn_off
    entity_id: input_boolean._REDACTED__away
